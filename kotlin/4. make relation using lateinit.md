# ì—°ê´€ê´€ê³„ ì •ì˜ ì‹œ lateinit ì‚¬ìš©

### ğŸ“Œ `lateinit`: ì´ˆê¸°í™”ë¥¼ ë’¤ë¡œ ë¯¸ë£° ìˆ˜ ìˆìŒ
- ì½”ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë•Œê¹Œì§€ ì´ˆê¸°í™”ë¥¼ ë¯¸ë£¨ì–´ ê¼­ í•„ìš”í•œ ìƒí™©ì— ì´ˆê¸°í™”ë¥¼ í•´ ì„±ëŠ¥í–¥ìƒ ë° ìì› íš¨ìœ¨ì„±ì„ ë„ì›€

```kotlin
@Entity
class Person {
    @Id
    val id: Long     // compile error: Property must be initialized or be abstract

    @Column
    val name: String // compile error: Property must be initialized or be abstract
}
```
### ğŸ“Œ javaì™€ ë‹¬ë¦¬ ì´ˆê¸°í™” í•˜ì§€ ì•Šê³  Property ì •ì˜ ëª»í•¨. ë‘ ì „ëµ ì¤‘ í•˜ë‚˜ë¥¼ ì·¨í•´ì•¼í•¨

1. ìƒì„±ì ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬ë°›ê¸°
```kotlin
@Entity
class Person(
  id: Long,
  name: String,
) {
    @Id
    val id: Long = id

    @Column
    val name: String = name
}
```

2. ê¸°ë³¸ê°’ì„ ë„£ì–´ì£¼ê¸°
```kotlin
@Entity
class Person {
    @Id
    val id: Long = 0L

    @Column
    val name: String = ""
}
```

## lateinitê³¼ ì—°ê´€ê´€ê³„

```kotlin
@Entity
class Board(
  title: String,
  writerId: Long,
) {
  @Id
  var id: Long = 0L

  @Column
  var title: String = title

  @Column
  var writerId: Long = writer.id

  @ManyToOne(fetch = FetchType.LAZY)
  @JoinColumn(name = "writerId")
  lateinit var writer: User
}
```
lateinitìœ¼ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ì •ì˜í•œ ì½”ë“œë‹¤.
ì»´íŒŒì¼, ì¡°íšŒê¸°ëŠ¥ ëª¨ë‘ ì˜ ë™ì‘í•œë‹¤.

```kotlin
@DataJpaTest(showSql = true)
class BoardRepositoryTest {
    @Autowired lateinit var testEntityManager: TestEntityManager
    @Autowired lateinit var boardRepository: BoardRepository

    @Test
    fun test_get_writer() {
        // Given
        val user = User("í™ê¸¸ë™")
        val board = Board("ê²Œì‹œíŒ", user.id)
        testEntityManager.persistAndFlush(user)
        testEntityManager.persistAndFlush(board)
        testEntityManager.detach(user)
        testEntityManager.detach(board)

        // When
        val actual = board2Repository.getReferenceById(board.id)

        // Then
        Assertions.assertEquals("í™ê¸¸ë™", actual.writer.name)
    }
}
```
ì¿¼ë¦¬ë„ ì˜ ì‘ë™í•œë‹¤
```
Hibernate: 
    insert 
    into
        "user"
        (name, id) 
    values
        (?, ?)
Hibernate: 
    insert 
    into
        board
        (title, writer_id, id) 
    values
        (?, ?, ?)
Hibernate: 
    select
        board0_.id as id1_1_0_,
        board0_.title as title2_1_0_,
        board0_.writer_id as writer_i3_1_0_ 
    from
        board board0_
    where
        board0_.id=?
Hibernate: 
    select
        user0_.id as id1_5_0_,
        user0_.name as name2_5_0_ 
    from
        "user" user0_ 
    where
        user0_.id=?
```

### ê·¸ë ‡ë‹´ ë¬´ì—‡ì´ ë¬¸ì œë€ ë§ì¸ê°€!
> ğŸš¨ ì•„ë˜ì™€ ê°™ì´ ìƒì„±í•œ ì§í›„ì˜ Entityë¥¼ ë‹¤ë£° ë•Œ ë°œìƒ (literally ë¹„ì˜ì† ìƒí…Œ)

```kotlin
val user = User("í™ê¸¸ë™")
val board = Board2("ê²Œì‹œíŒ", user.id)
val writer = board.writer // error: lateinit property writer has not been initialized
```

* ì˜ì†í™”ëœ Entity ì¡°íšŒ: JPAê°€ writerë¥¼ ì´ˆê¸°í™”
* ë§‰ ìƒì„±ëœ ë¹„ì˜ì†ìƒíƒœì˜ Entity: JPAê°€ writerë¥¼ ì´ˆê¸°í™” âŒ(JPAì˜ ì˜ì—­ ì•„ë‹˜)

lateinitì„ ì‚¬ìš©í•˜ë©´ ìœ„ì™€ ê°™ì€ ì˜¤ë¥˜ë¥¼ ë§ˆì£¼ì¹˜ê²Œ ë˜ê³  ì´ ì˜¤ë¥˜ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ì–µì§€ìŠ¤ëŸ¬ìš´ ì½”ë“œê°€ ìƒê²¨ë‚¨